# Implementation Plan

## MVP版本实现任务

- [x] 1. 创建主游戏界面UI
  - 创建MainGameUI预制体，包含余额显示、下注输入、倍数显示、HOLD按钮等核心UI元素
  - 实现UI组件的基本交互逻辑
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 9.1, 9.2, 9.3, 9.4_

- [x] 2. 实现ECS核心组件
  - 创建GameStateComp、BettingComp、MultiplierComp、UserDataComp、LocalDataComp等核心组件
  - 实现组件的数据结构和重置方法
  - _Requirements: 1.1, 1.2, 2.1, 3.1, 15.1, 15.2_

- [x] 3. 创建游戏实体
  - 实现CrashGame主实体，添加所需的组件
  - 创建DogRocket实体用于火箭视觉表现
  - _Requirements: 3.1, 3.4_

- [x] 4. 实现游戏状态系统
  - 创建CrashGameSystem处理游戏主流程
  - 实现WAITING、FLYING、CRASHED、CASHED_OUT四种状态的处理逻辑
  - _Requirements: 1.1, 3.1, 3.5, 4.1, 4.2, 4.3, 4.4_

- [x] 5. 实现倍数计算系统
  - 创建MultiplierSystem，使用简单的时间算法计算倍数
  - 实现倍数实时更新和崩盘检测
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5, 3.2, 3.3_

- [x] 6. 实现本地数据管理
  - 创建UserDataSystem和LocalDataComp
  - 实现用户ID生成、本地数据存储和加载
  - 实现崩盘倍数的本地随机生成
  - _Requirements: 15.1, 15.2, 15.3, 15.4, 15.5, 5.1, 5.2_

- [x] 7. 实现火箭视觉系统基础
  - 创建RocketViewComp和RocketSystem
  - 实现火箭起飞、飞行、崩盘的视觉表现
  - _Requirements: 3.1, 3.4, 5.3, 7.1, 7.2, 7.4_

- [x] 8. 实现音频系统基础
  - 集成CrashGameAudio类，使用oops.audio管理音效
  - 创建音效播放接口
  - _Requirements: 7.1, 7.2, 7.3, 7.4, 7.5_

- [x] 9. 实现游戏历史记录组件
  - 创建GameHistoryComp存储游戏记录
  - 实现游戏结果的记录和本地存储
  - _Requirements: 6.1, 6.2, 6.3, 6.4, 10.1, 10.2, 10.3, 10.4_

- [x] 10. 实现多语言支持基础
  - 创建CrashGameLanguage类，配置中英文语言包
  - 实现界面文本的多语言显示
  - _Requirements: 8.1, 8.2, 8.3, 8.4_

- [x] 11. 修复HOLD按钮交互逻辑（紧急Bug修复）
  - 将点击式交互改为按住式交互（TOUCH_START开始游戏，TOUCH_END提现）
  - 实现按住按钮时的视觉反馈和状态变化
  - 修复按钮状态管理，确保正确的游戏流程
  - _Requirements: 1.1, 1.2, 3.1, 3.5_

- [x] 12. 修复倍率计算和崩盘时机（紧急Bug修复）
  - 调整倍率增长算法，使其更合理（当前增长过快）
  - 优化崩盘倍数生成算法，确保有合理的游戏时长
  - 添加调试日志，显示当前倍率和目标崩盘倍率
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5, 5.1, 5.2_

- [x] 13. 实现背景场景系统
  - 创建SceneBackgroundComp组件管理背景场景
  - 实现多层背景场景（普通场景、火箭分离场景、太空场景）
  - 实现场景向下滚动效果，营造火箭向上飞行的视觉
  - 根据飞行时间自动切换不同背景场景
  - _Requirements: 3.4, 7.1, 7.2, 7.4_

- [ ] 14. 完善游戏主界面预制体
  - 创建完整的MainGameUI预制体，包含所有UI元素
  - 配置UI元素的属性和引用关系
  - 实现响应式布局适配不同屏幕尺寸
  - _Requirements: 9.1, 9.2, 9.3, 9.4, 14.1, 14.2, 14.3, 14.4_

- [ ] 15. 实现火箭视觉效果和动画
  - 添加小狗火箭的精灵图片和动画
  - 实现火箭起飞、飞行轨迹、崩盘动画
  - 添加推进器粒子效果和爆炸特效
  - _Requirements: 3.4, 7.1, 7.2, 7.4_

- [ ] 16. 添加音频资源和完善音效系统
  - 添加游戏所需的音频文件（起飞、倍数变化、提现、崩盘等音效）
  - 完善CrashGameAudio类的音效播放功能
  - 实现背景音乐播放和音量控制
  - _Requirements: 7.1, 7.2, 7.3, 7.4, 7.5_

- [ ] 17. 实现下注系统逻辑
  - 在CrashGameSystem中添加下注验证逻辑
  - 实现余额检查和下注金额限制
  - 添加下注失败的错误提示
  - _Requirements: 1.1, 1.2, 1.3, 1.4_

- [ ] 18. 完善游戏历史记录功能
  - 实现游戏结果的自动记录
  - 添加历史记录的本地存储和加载
  - 创建历史记录UI界面显示最近游戏记录
  - _Requirements: 6.1, 6.2, 6.3, 6.4, 10.1, 10.2, 10.3, 10.4_

- [ ] 19. 实现排行榜功能
  - 创建LeaderboardComp组件存储排行榜数据
  - 实现本地排行榜数据管理
  - 创建排行榜UI界面显示玩家排名
  - _Requirements: 11.1, 11.2, 11.3, 11.4_

- [ ] 20. 实现错误处理和用户反馈系统
  - 创建GameErrorHandler处理各种错误情况
  - 使用oops.gui.toast显示用户提示信息
  - 添加网络异常和资源加载失败的处理
  - _Requirements: 1.3, 5.4_

- [ ] 21. 实现界面导航和UI管理
  - 配置oops.gui的UI层级和界面ID
  - 实现主界面、历史记录、排行榜、设置界面之间的切换
  - 添加返回按钮和界面状态管理
  - _Requirements: 12.1, 12.2, 12.3, 12.4, 13.1, 13.2, 13.3, 13.4_

- [ ] 22. 实现加载界面和启动流程
  - 创建游戏启动加载界面
  - 添加资源加载进度显示
  - 实现从加载界面到主游戏界面的过渡
  - _Requirements: 13.1, 13.2, 13.3, 13.4_

- [ ] 23. 完善多语言支持
  - 完善中英文语言包的所有文本
  - 实现语言切换功能
  - 添加数字格式化的本地化支持
  - _Requirements: 8.1, 8.2, 8.3, 8.4_

- [ ] 24. 游戏测试和调试
  - 测试完整的游戏流程（下注、飞行、提现、崩盘）
  - 测试UI交互和界面切换
  - 测试音效播放和多语言切换
  - 修复发现的bug和优化用户体验
  - _Requirements: 所有需求的综合测试_

- [ ] 25. 性能优化和最终调试
  - 优化游戏性能和内存使用
  - 测试不同设备和屏幕尺寸的适配
  - 进行端到端测试确保游戏稳定运行
  - 准备游戏发布版本
  - _Requirements: 所有需求的最终验证_